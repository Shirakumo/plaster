<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Plaster</title>
    <link rel="stylesheet" type="text/css" href="../static/plaster.css" @href="/static/plaster/plaster.css" />
    <link rel="stylesheet" type="text/css" @href="/static/plaster/codemirror/codemirror.css" />
    <link id="static-codemirror-root" rel="alternate" @href="/static/plaster/codemirror/" />
  </head>
  <body>
    <header>
      <h1>Plaster</h1>
      <nav>
        <c:when test="(plaster::permitted :new)">
          <a href="#" @href="plaster/edit">New</a>
        </c:when>
        <c:when test="(plaster::permitted :list)">
          <a href="#" @href="plaster/list">List</a>
        </c:when>
        <c:if test="(auth:current)">
          <c:then><c:when test="(plaster::permitted :user)">
            <a href="#" @href="plaster/user/{0} (user:username (auth:current))">My Pastes</a>
          </c:when></c:then>
          <c:else>
            <a href="#" @href="<auth page login #>">Login</a>
          </c:else>
        </c:if>
      </nav>
    </header>
    <main>
      <c:when test="error">
        <div class="infobox" id="error" lquery="(text error)">ERROR</div>
      </c:when>
      <c:when test="message">
        <div class="infobox" id="message" lquery="(text message)">MESSAGE</div>
      </c:when>
      <c:using value="paste">
        <form class="edit" method="post" action="#">
          <header>
            <input type="text" name="title" placeholder="Untitled" maxlength="32" lquery="(val title)" />
            <select class="type" name="type" iterate="(** :types)">
              <option lquery="(text *) (attr :value * :selected (equal * (** :type)))">TYPE</option>
            </select>
            <c:if test="(** :parent)">
              <c:then>
                <div class="annotate">
                  Annotating paste <span lquery="(text (** :parent))">#</span>
                </div>
              </c:then>
              <c:else>
                <div class="visibility">
                  Visibility: <select name="visibility">
                  <option value="1" lquery="(attr :selected (eql 1 visibility))">public</option>
                  <option value="2" lquery="(attr :selected (eql 2 visibility))">unlisted</option>
                  <option value="3" lquery="(attr :selected (eql 3 visibility))">private</option>
                  </select>
                  <input type="password" name="password" placeholder="password" lquery="(val (** :password))" />
                </div>
              </c:else>
            </c:if>
          </header>
          <textarea name="text" placeholder="Paste something here" autofocus required lquery="(text text)"></textarea>
          <nav class="actions">
            <input type="hidden" name="id" lquery="(val _id)" />
            <input type="hidden" name="browser" value="true" />
            <input type="hidden" name="parent" lquery="(val (** :parent))" />
            <input type="hidden" name="current-password" lquery="(val (** :password))" />
            <c:if test="(or (** :repaste) (dm:hull-p *))">
              <c:then>
                <input type="submit" @formaction="/api/plaster/new" value="Post" />
              </c:then>
              <c:else>
                <c:when test="(plaster::permitted :delete *)">
                  <input type="submit" @formaction="/api/plaster/delete" value="Delete" />
                </c:when>
                <c:when test="(plaster::permitted :edit *)">
                  <input type="submit" @formaction="/api/plaster/edit" value="Save" />
                </c:when>
              </c:else>
            </c:if>
          </nav>
        </form>
      </c:using>
    </main>
    <footer>
    </footer>
    <script type="text/javascript" @src="/static/plaster/codemirror/codemirror.js" />
    <script type="text/javascript" @src="/static/plaster/plaster.js" />
  </body>
</html>
